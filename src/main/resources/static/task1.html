<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人情报登录</title>
  <script type="text/javascript" ></script>

  <style>

    body {
      margin: 0px;
      padding: 0px;
      background-image: url('background.webp');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center center;
    }
    .header{
      font-size: 22px;
      text-align: center;
      margin:20px auto;
    }

    .question {
      display: inline-block;
      width: 300px;
      text-align: right;
    }
    .answer {
      display: inline;
      width: 300px;
      position: relative;
    }



    .biaoqian {
      display: inline-block;
      width: 300px;
      text-align: right;
    }

    select {
      display: inline-block;
      width: 500px;
      height: 30px;
    }

    p {
      font-size: small;
      display: block;
      text-align: center;
      padding: 20px;
    }

    input[type="text"] {
      width: 200px;
    }

    .tishi {
      position: absolute;
      width: 200px;
      z-index: 1;
    }

    .tijiao {
      text-align: center;
    }

    .center-div {
      text-align: center;
    }

    .button{
      width: 100px;
      height: 30px;
      line-height: 15px;
      background:darkslateblue;
      color: deepskyblue;
      text-align: center;
    }

    span{
      color: red;
      font-size: 15px;
    }
  </style>

</head>
<body>

<div class="header">
  <h2>基本情報</h2>
</div>

<!--表格-->
<form class="form" id="form-save">


  <!--设置姓-->
  <label class="question" id="xingLable">姓(漢字) </label>
  <div class="answer">
    <input type="text" name="xing" id="xing" placeholder="全角文字で入力してください">
    <span class="tishi" id="tsxing"></span>
  </div>

<!--  设置名-->
  <label class="question">名(漢字)</label>
  <div class="answer">
    <input type="text" name="ming" id="ming" placeholder="全角文字で入力してください"  >
    <span class="tishi" id="tsming"></span>
  </div>
<br><br>
  <!--设置セイ-->
  <label class="question">セイ</label>
  <div class="answer">
    <input type="text" name="sei" id="sei" placeholder="カタカナで入力してください" >
    <span class="tishi" id="tssei"></span>
  </div>

  <!--设置メイ-->
  <label class="question">メイ</label>
  <div class="answer">
    <input type="text" name="mei" id="mei" placeholder="カタカナで入力してください" >
    <span class="tishi" id="tsmei"></span>
  </div>

  <br><br>
  <!--设置姓(ローマ字)-->
  <label class="question">姓(ローマ字)</label>
  <div class="answer">
    <input type="text" name="romasei" id="romasei" placeholder="ローマ字で入力してください" >
    <span class="tishi" id="tsromasei"></span>
  </div>

  <!--设置名(ローマ字)-->
  <label class="question">名(ローマ字)</label>
  <div class="answer">
    <input type="text" name="romamei" id="romamei" placeholder="ローマ字で入力してください" >
    <span class="tishi" id="tsromamei"></span>
  </div>

  <br><br>
  <!--选择国籍-->
  <label class="biaoqian">国籍</label>
  <select name="country" id="country">
    <option value="">オプションを選択してください。</option>
    <option value="中国">中国</option>
    <option value="日本">日本</option>
    <option value="韓国">韓国</option>
    <option value="スペイン">スペイン</option>
    <option value="その他">その他</option>
  </select>

  <br><br>
  <div id="countryInput" class="center-div" style="display: none;">
    <label>国籍入力</label>
    <input type="text" name="countryInput">
  </div>

  <p>母語が日本語ではない方は日本語能力を証明する書類を提出していただく必要があります。詳細は募集要項をご確認ください</p>

  <!--设置性别-->
  <label class="biaoqian"> 性别：</label>
  <label><input type="radio" name="sex" id="sex1" value="男">男</label>
  <label><input type="radio" name="sex" id="sex2" value="女">女</label>
  <label><input type="radio" name="sex" id="sex3" value="Decline to State(声明拒否)">Decline to State(声明拒否)</label>


  <!--  设置生日-->
    <label for="birthday">出生日期：</label>
    <input type="date" id="birthday" name="birthday">



    <br><br>
  <!--電話番号-->
  <label class="biaoqian">電話番号</label>
  <div class="answer">
    <input type="text" class="answer" id="tel" name="tel"  >
    <span id="tstel"></span>
  </div>

  <br><br>

  <!--携帯電話-->
  <label class="biaoqian">携帯電話</label>
  <div class="answer">
    <input type="text" class="answer" id="phone" name="phone" >
    <span id="tsphone"></span>
  </div>

  <br><br>

  <!--设置职业-->
  <label class="biaoqian">職業</label>
  <select id="job" name="job" >
    <option value="">オブションを選択</option>
    <option value="01自営業" >01 自営業</option>
    <option value="02公務員" >02 公務員</option>
    <option value="03会社役員" >03 会社役員</option>
    <option value="04その他" >04 その他</option>
    <option value="05無職" >05 無職</option>
  </select>



  <!--设置职务-->
  <label class="biaoqian"> 勤務先(任意) </label>
  <div class="answer">
    <input type="text" class="answer" id="address" name="address"  >
    <span id="tsaddress"></span>
  </div>

<br>
<!--  设置底部2个按钮-->
  <div class="tijiao">
    <button type="button" class="button" id="save" name="submit" >基本情報保存</button>&nbsp;&nbsp;
    <button type="button" class="button" id="next" name="submit" >次へ</button>
  </div>

  <br><br>
</form>


<!--交互实现-->
<script>
  //获取输入框
 let xingInput = document.getElementById('xing');
 let mingInput = document.getElementById('ming');
 let seiInput = document.getElementById('sei');
 let meiInput = document.getElementById('mei');
 let romaseiInput = document.getElementById('romasei');
 let romameiInput = document.getElementById('romamei');
 let countryInput = document.getElementById('country');
 let birthInput = document.getElementById('birthday');
 let telInput = document.getElementById('tel');
 let phoneInput = document.getElementById('phone');
 let jobInput = document.getElementById('job');
 let cpsameInput = document.getElementById('cpsame');
 let addressInput = document.getElementById('address');
 let saveButton = document.getElementById('save');
 let nextButton = document.getElementById('next');
 // let shinseishaname = sessionStorage.getltem('shinseishaname');
 // let shinseishaid = sessionStorage.getltem('shinseishaid');
  // $("#reason").attr("value",localStorage.getltem("unfinishedreason")),
  // $("#shinseishaname").html(申请者)+sessionStorage.getltem("shinseishaname");




 //监听save按钮
   saveButton.addEventListener('click', () => {

     //先获取输入的值
     let xing = xingInput.value;
     let ming = mingInput.value;
     let sei = seiInput.value;
     let mei = meiInput.value;
     let romasei = romaseiInput.value;
     let romamei = romameiInput.value;
     //通过option集合获取选项的值
     let country = countryInput.options[countryInput.selectedIndex].value;
     //获取单选的值。并把他赋值给sex
     let gender = document.getElementsByName("sex");
     let sexValue='';
     for (let i = 0; i < gender.length; i++) {
       if (gender[i].checked === true) {
         sexValue = gender[i].value;
       }
     }
     let sex = sexValue;

     let birth = birthInput.value;
     let tel = telInput.value;
     let phone = phoneInput.value;
     let job = jobInput.options[jobInput.selectedIndex].value;
     let address = addressInput.value;

     //通过正则表达式来看输入框输的对不对
     let check1 =/^[\u4E00-\u9FA5]+$/;
        if (check1.test(xingInput.value)===false) {
       alert('姓を漢字で入力してください');
       return;
      }

        if (xingInput.value.length>20) {
       alert('入力した姓が長すぎます。20字内で再入力してください。')
       return;
        }

        if (check1.test(mingInput.value)===false) {
       alert('名を漢字で入力してください')
       return;
        }


        if (mingInput.value.length>20) {
         alert('入力した名が長すぎます。20字内で再入力してください。')
         return;
       }

     let check2 = /^[ｧ-ﾝﾞﾟ]+$/;
     if (check2.test(seiInput.value)===false) {
       alert('セイをカタカナでで入力してください')
       return;
     }

     if (seiInput.value.length>20) {
       alert('入力したセイが長すぎます。20字内で再入力してください。')
       return;
     }

     if (check2.test(meiInput.value)===false) {
       alert('メイをカタカナでで入力してください')
       return;
     }

     if (meiInput.value.length>20) {
       alert('入力したメイが長すぎます。20字内で再入力してください。')
       return;
     }

      let check3 = /^[a-zA-Z]+$/g;
      if (check3.test(romaseiInput.value)===false) {
      alert('姓をローマ字で入力してください')
      return;
      }

      if (romaseiInput.value.length>20) {
      alert('入力した姓が長すぎます。20字内で再入力してください。')
      return;
      }

      let check4 = /^[a-zA-Z]*$/g;

      if (check4.test(romameiInput.value)===false) {
      alert('名をローマ字で入力してください')
      return;
      }

      if (romameiInput.value.length>20) {
      alert('入力した名が長すぎます。20字内で再入力してください。')
      return;
    }

     let check5 = /^\d{11}$/;

     if (check5.test(telInput.value)===false) {
       alert('電話番号を11個数字で入力してください。')
       return;
     }

     if (check5.test(phoneInput.value)===false) {
       alert('携帯電話を11個数字で入力してください。')
       return;
     }

     //因为address已经是一个文本输入框了，不属于js变量，所以不用let关键字也成
     if (addressInput.value.length>20) {
       alert('入力した文字が長すぎます。20字内で再入力してください。')
       return;
     }

    //将数据保存到数据库中
    //Fetch API是浏览器内置的Web API，用于在客户端与服务器之间进行网络通信。

     fetch('/users/add', {
       //指定请求方法为POST，表示向服务器提交数据。
       method: 'POST',
       //指定请求头，告诉服务器请求体的格式为JSON格式。
       headers: {
         'Content-Type': 'application/json'
       },
       //将JSON对象转换为字符串，然后作为请求体传递给服务器。
       body: JSON.stringify({xing, ming, sei, mei, romasei, romamei, country, sex, birth, tel, phone, job, address})
     })
             // 信息都正确的话就传输到数据库

             .then(response => {
               if (response.ok) {
                 alert('保存成功');


                 // sessionStorage.setltem("shinseishaid",xing);

               } else {
                 return response.text().then(text => {
                   throw new Error(text)
                 });
               }
             })
             // 如果存在问题, 就alert提示错误

             .catch(error => {
               alert(error.message);
             });
   });


  nextButton.addEventListener('click', () => {

    let xing = xingInput.value;
    let ming = mingInput.value;
    let sei = seiInput.value;
    let mei = meiInput.value;
    let romasei = romaseiInput.value;
    let romamei = romameiInput.value;
    let country = countryInput.options[countryInput.selectedIndex].value;
    let gender = document.getElementsByName("sex");
    let sexValue='';
    for (let i = 0; i < gender.length; i++) {
      if (gender[i].checked === true) {
        sexValue = gender[i].value;
      }
    }
    let sex = sexValue;
    let birth = birthInput.value;
    let tel = telInput.value;
    let phone = phoneInput.value;
    let job = jobInput.options[jobInput.selectedIndex].value;
    let address = addressInput.value;
    // 存储名字到LocalStorage中
    localStorage.setItem( "xing",xing);
    localStorage.setItem( "ming",ming);
    localStorage.setItem( "phone",phone);
    localStorage.setItem( "address",address);

    let check1 = /^[\u4E00-\u9FA5]+$/;
    if (check1.test(xingInput.value)===false) {
      alert('姓を漢字で入力してください')
      return;
    }
    if (xingInput.value.length>20) {
      alert('入力した姓が長すぎます。20字内で再入力してください。')
      return;
    }
    if (check1.test(mingInput.value)===false) {
      alert('名を漢字で入力してください')
      return;
    }
    if (mingInput.value.length>20) {
      alert('入力した名が長すぎます。20字内で再入力してください。')
      return;
    }
    let check2 = /^[ｧ-ﾝﾞﾟ]+$/;
    if (check2.test(seiInput.value)===false) {
      alert('セイをカタカナでで入力してください')
      return;
    }
    if (seiInput.value.length>20) {
      alert('入力したセイが長すぎます。20字内で再入力してください。')
      return;
    }
    if (check2.test(meiInput.value)===false) {
      alert('メイをカタカナでで入力してください')
      return;
    }
    if (meiInput.value.length>40) {
      alert('入力したメイが長すぎます。40字内で再入力してください。')
      return;
    }
    let check3 = /^[a-zA-Z]+$/g;
    if (check3.test(romaseiInput.value)===false) {
      alert('姓をローマ字で入力してください')
      return;
    }
    if (romaseiInput.value.length>20) {
      alert('入力した姓が長すぎます。20字内で再入力してください。')
      return;
    }

    let check4 = /^[a-zA-Z]*$/g;
    if (check4.test(romameiInput.value)===false) {
      alert('名をローマ字で入力してください')
      return;
    }

    if (romameiInput.value.length > 20) {
      alert('入力した名が長すぎます。20字内で再入力してください。')
      return;
    }
    let check5 = /^\d{11}$/;
    if (check5.test(telInput.value) === false) {
      alert('電話番号を11個数字で入力してください。')
      return;
    }
    if (check5.test(phoneInput.value) === false) {
      alert('携帯電話を11個数字で入力してください。')
      return;
    }
    if (addressInput.value.length > 20) {
      alert('入力した文字が長すぎます。20字内で再入力してください。')
      return;
        }

    //将取得的数据保存到数据库
    fetch('/users/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({xing, ming, sei, mei, romasei, romamei, country, sex, birth, tel, phone, job, address})
    })
            // 所有信息都正确的话就传输到数据库

            .then(response => {
              if (response.ok) {
                alert('保存成功');
                //保存成功后跳转到新的页面

                // console.log("xing" + xing)
                window.location.href="task2.html"
              } else {
                return response.text().then(text => {
                  throw new Error(text)
                });
              }
            })
            // 如果存在有问题的输入, 就alert提示错误

            .catch(error => {
              alert( error.message);
            });
  });


     //检查输入框，然后根据内容提示
    xingInput.onblur = function () {
    let tsxing = document.getElementById('tsxing');
    let check1 = /^[\u4E00-\u9FA5]+$/;

    if (check1.test(xingInput.value)===false) {
      tsxing.innerHTML = '姓を漢字で入力してください';
    } else if (xingInput.value.length>20) {
      tsxing.innerHTML = '入力した姓が長すぎます。20字内で再入力してください。';
    }
    else {
      tsxing.innerHTML = '';
    }
  };

  mingInput.onblur = function () {
    let tsming = document.getElementById('tsming');
    let check1 = /^[\u4E00-\u9FA5]+$/;
    if (check1.test(mingInput.value)===false) {
      tsming.innerHTML = '名を漢字で入力してください';
    } else if (mingInput.value.length>20) {
      tsming.innerHTML = '入力した名が長すぎます。20字内で再入力してください。';
    }
    else {
      tsming.innerHTML = '';
    }
  };

  seiInput.onblur = function () {
    let tssei = document.getElementById('tssei');
    let check2 = /^[ｧ-ﾝﾞﾟ]+$/;
    if (check2.test(seiInput.value)===false) {
      tssei.innerHTML = 'セイをカタカナでで入力してください';
    } else if (seiInput.value.length>20) {
      tssei.innerHTML = '入力したセイが長すぎます。20字内で再入力してください。';
    }
    else {
      tssei.innerHTML = '';
    }
  };

  meiInput.onblur = function () {
    let tsmei = document.getElementById('tsmei');
    let check2 =/^[ｧ-ﾝﾞﾟ]+$/;
    if (check2.test(meiInput.value)===false) {
      tsmei.innerHTML = 'メイをカタカナでで入力してください';
    } else if (meiInput.value.length>20) {
      tsmei.innerHTML = '入力したメイが長すぎます。20字内で再入力してください。';
    }
    else {
      tsmei.innerHTML = '';
    }
  };

  romaseiInput.onblur = function () {
    let tsromasei = document.getElementById('tsromasei');
    let check3 = /^[a-zA-Z]+$/g;
    if (check3.test(romaseiInput.value)===false) {
      tsromasei.innerHTML = '姓をローマ字で入力してください';
    } else if (romaseiInput.value.length>40) {
      tsromasei.innerHTML = '入力した姓が長すぎます。20字内で再入力してください。';
    }
    else {
      tsromasei.innerHTML = '';
    }
  };
  romameiInput.onblur = function () {
    let tsromamei = document.getElementById('tsromamei');
    let check3 = /^[a-zA-Z]+$/g;
    if (check3.test(romameiInput.value)===false) {
      tsromamei.innerHTML = '名をローマ字で入力してください';
    } else if (romameiInput.value.length>20) {
      tsromamei.innerHTML = '入力した名が長すぎます。20字内で再入力してください。';
    }
    else {
      tsromamei.innerHTML = '';
    }
  };

  telInput.onblur = function () {
    let tstel = document.getElementById('tstel');
    let check5 = /^\d{11}$/;
    if (check5.test(telInput.value)===false) {
      tstel.innerHTML = '電話番号を11個数字で入力してください。';
    }
    else {
      tstel.innerHTML = '';
    }
  };


  phoneInput.onblur = function () {
    let telSave = telInput.value;
    localStorage.setItem("tel", telSave);
    let tsphone = document.getElementById('tsphone');
    let check5 = /^\d{11}$/;
    if (check5.test(phoneInput.value)===false) {
      tsphone.innerHTML = '携帯電話を11個数字で入力してください';
    }
    else {
      tsphone.innerHTML = '';
    }

  };

        //session
        // const xingInput=document.getElementById("xing");
        //获取提交按钮
        // const nextbutton = document.getElementById("next");
        // // 给提交按钮绑定点击事件
        // nextbutton.addEventListener("click",() => {
        //   // /获取名字
        // const xing = xingInput.value();
        // // 存储名字到LocalStorage中
        // localStorage.setItem( "xing",xing);
        //  });



  // カタカナ的全角转换为半角

  function zenkana2Hankana(str) {
    let kanaMap = {
      "ガ": "ｶﾞ", "ギ": "ｷﾞ", "グ": "ｸﾞ", "ゲ": "ｹﾞ", "ゴ": "ｺﾞ",
      "ザ": "ｻﾞ", "ジ": "ｼﾞ", "ズ": "ｽﾞ", "ゼ": "ｾﾞ", "ゾ": "ｿﾞ",
      "ダ": "ﾀﾞ", "ヂ": "ﾁﾞ", "ヅ": "ﾂﾞ", "デ": "ﾃﾞ", "ド": "ﾄﾞ",
      "バ": "ﾊﾞ", "ビ": "ﾋﾞ", "ブ": "ﾌﾞ", "ベ": "ﾍﾞ", "ボ": "ﾎﾞ",
      "パ": "ﾊﾟ", "ピ": "ﾋﾟ", "プ": "ﾌﾟ", "ペ": "ﾍﾟ", "ポ": "ﾎﾟ",
      "ヴ": "ｳﾞ", "ヷ": "ﾜﾞ", "ヺ": "ｦﾞ",
      "ア": "ｱ", "イ": "ｲ", "ウ": "ｳ", "エ": "ｴ", "オ": "ｵ",
      "カ": "ｶ", "キ": "ｷ", "ク": "ｸ", "ケ": "ｹ", "コ": "ｺ",
      "サ": "ｻ", "シ": "ｼ", "ス": "ｽ", "セ": "ｾ", "ソ": "ｿ",
      "タ": "ﾀ", "チ": "ﾁ", "ツ": "ﾂ", "テ": "ﾃ", "ト": "ﾄ",
      "ナ": "ﾅ", "ニ": "ﾆ", "ヌ": "ﾇ", "ネ": "ﾈ", "ノ": "ﾉ",
      "ハ": "ﾊ", "ヒ": "ﾋ", "フ": "ﾌ", "ヘ": "ﾍ", "ホ": "ﾎ",
      "マ": "ﾏ", "ミ": "ﾐ", "ム": "ﾑ", "メ": "ﾒ", "モ": "ﾓ",
      "ヤ": "ﾔ", "ユ": "ﾕ", "ヨ": "ﾖ",
      "ラ": "ﾗ", "リ": "ﾘ", "ル": "ﾙ", "レ": "ﾚ", "ロ": "ﾛ",
      "ワ": "ﾜ", "ヲ": "ｦ", "ン": "ﾝ",
      "ァ": "ｧ", "ィ": "ｨ", "ゥ": "ｩ", "ェ": "ｪ", "ォ": "ｫ",
      "ッ": "ｯ", "ャ": "ｬ", "ュ": "ｭ", "ョ": "ｮ",
      "。": "｡", "、": "､", "ー": "ｰ", "「": "｢", "」": "｣", "・": "･"
    }
    let reg = new RegExp('(' + Object.keys(kanaMap).join('|') + ')', 'g');
    return str
            .replace(reg, function (match) {
              return kanaMap[match];
            })
            .replace(/゛/g, 'ﾞ')
            .replace(/゜/g, 'ﾟ');
  };

  // 将姓的カナ全角转换为半角

  seiInput.oninput = function () {
    seiInput.value=zenkana2Hankana(seiInput.value)
  };
  // 将名的カナ全角转换为半角

  meiInput.oninput = function () {
    meiInput.value=zenkana2Hankana(meiInput.value)
  };

  // 监听国籍选择框变化事件，显示或隐藏国籍输入框
  document.addEventListener("DOMContentLoaded", function() {
    const countrySelect = document.getElementById('country');
    const countryInput = document.getElementById('countryInput');

    countrySelect.addEventListener('change', function() {
      if (countrySelect.value === 'その他') {
        countryInput.style.display = 'block';
      } else {
        countryInput.style.display = 'none';
      }
    });
  });


  <!--  如果输入国籍为其他，那么就会显示隐藏的国籍输入框-->
        document.addEventListener("DOMContentLoaded", function() {
          const countrySelect = document.getElementById('country');
          const countryInput = document.getElementById('countryInput');

    countrySelect.addEventListener('change', function() {
      if (countrySelect.value === 'その他') {
        countryInput.style.display = 'block';
      } else {
        countryInput.style.display = 'none';
      }
    });
  });

      // 如果输入没有职业.那么后面具体的工作栏将变得无法输入
      const jobSelect = document.querySelector('#job');
      const jobaddressInput = document.querySelector('#address');

      jobSelect.addEventListener('change', function() {
        if (this.value === '05無職') {
          jobaddressInput.disabled = true;
          jobaddressInput.value = '';
        } else {
          jobaddressInput.disabled = false;
        }
      });

  // 获取当前日期并格式化为 ISO 格式
  var today = new Date();
  var isoDate = today.toISOString().split('T')[0];

  // 设置日期控件的最大日期为今天
  document.getElementById('birthday').setAttribute('max', isoDate);

  //
  // // 将携带电话和同居值存储在sessionStorage中
  // sessionStorage.setItem("phone", phoneInput.value);
  // sessionStorage.setItem("cpsame", cpsameInput.value);


</script>


</body>
</html>